<?php

class Home extends CI_Controller {

    public function __construct() {
        parent::__construct();
        session_start();
		$grup	= $this->user_model->sesi_grup($_SESSION['sesi']);
		if($grup!=1 AND $grup!=2 AND $grup!=3) redirect('siteman');
    }

	public function index($p=1,$o=0){
		
		$data['p']        = $p;
		$data['o']        = $o;
		
		if(isset($_SESSION['cari']))
			$data['cari'] = $_SESSION['cari'];
		else $data['cari'] = '';
		
		if(isset($_POST['per_page'])) 
			$_SESSION['per_page']=$_POST['per_page'];
		$data['per_page'] = $_SESSION['per_page'];
		
		$data['paging']  = $this->home_model->paging($p,$o);
		
        $data1['active_menu'] = 1;
        $data1['ar'] = "yes";
        $data3['active_tab'] = 1;
	$header = $this->header_model->get_data();
        $data['list_pesan_uncategorized'] = $this->home_model->get_pesan_uncategorized($o,$data['paging']->offset, $data['paging']->per_page);
		
        $this->load->view('static/header', $header);
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('home_hero', $data);
        $this->load->view('static/footer');
    }

    public function pengkategorian_pesan($id=0) {
        if ($this->home_model->process_pengkategorian_pesan($id)) {
            $_SESSION['status'] = 1;
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home');
    }
	
	public function spam_pesan() {
        if ($this->home_model->process_spam_pesan()) {
            $_SESSION['status'] = 1;
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home');
    }

    public function dalam_proses($p=1,$o=0){
	
		$data['p']        = $p;
		$data['o']        = $o;
		
		if(isset($_POST['per_page'])) 
			$_SESSION['per_page']=$_POST['per_page'];
		$data['per_page'] = $_SESSION['per_page'];
		
		$header = $this->header_model->get_data();
        $data1['active_menu'] = 1;
        $data3['active_tab'] = 2;
		
		$data['paging']  = $this->home_model->paging_rc($p,$o);
        $data['list_respon_cepat'] = $this->home_model->get_kategori_respon_cepat($data['paging']->offset, $data['paging']->per_page);
        $this->load->view('static/header', $header);
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('respon_cepat/respon_cepat_hero',$data);
        $this->load->view('static/footer');
    }
    
    public function isu_terolah($p=1,$o=0){
    
    	$data['p']        = $p;
		$data['o']        = $o;
		
		if(isset($_POST['per_page'])) 
			$_SESSION['per_page']=$_POST['per_page'];
		$data['per_page'] = $_SESSION['per_page'];
    
        $data1['active_menu'] = 1;
      
        $data3['active_tab'] = 3;
        $data['paging']  = $this->home_model->paging_krc($p,$o);
        $data['list_kasus'] = $this->home_model->get_kasus_respon_cepat($data['paging']->offset, $data['paging']->per_page);
        $this->load->view('static/header', $data1);
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('respon_cepat/kasus_respon_cepat',$data);
        $this->load->view('static/footer');        
    }

    public function restore_pesan_dalam_proses() {

        if ($this->home_model->process_restore_pesan_respon_cepat($this->uri->segment(3))) {
		
            $_SESSION['status'] = 1;
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home/dalam_proses');
    }
    
    public function restore_pesan_respon_cepat_selected(){
        if ($this->home_model->process_restore_pesan_respon_cepat_selected()) {
            $_SESSION['status'] = 1;
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home/dalam_proses');        
    }
    
	public function rilis_pesan_dalam_proses($id_sms='') {

        if ($this->home_model->rilis_pesan_respon_cepat($id_sms)) {
		
            $_SESSION['status'] = 1;
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home/isu_rilis');
    }
	
	public function arsip_pesan_dalam_proses($id_sms='') {

        if ($this->home_model->arsip_pesan_respon_cepat($id_sms)) {
		
            $_SESSION['status'] = 1;
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home/isu_arsip');
    }
	
    public function form_edit_pesan_respon_cepat(){
	
        if($this->input->post('allowed') == "true"){
            
	    $data['detail'] = $this->home_model->get_detail_kategori_respon_cepat_by_id($this->uri->segment(3));
            $data['list_kabupaten'] = $this->pelapor_model->get_kabupaten();
          
            $data['list_isu'] = $this->pengaturan_model->get_all_topik();
            $this->load->view('respon_cepat/form_edit_respon_cepat',$data);
        } else {
            show_404();
        }
     }

    public function edit_pesan_respon_cepat(){
        if ($this->home_model->process_edit_pesan_respon_cepat()) {
            $_SESSION['status'] = 1;
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home/dalam_proses');        
    }
	
    
    public function history_isu_rilis(){
		
		$data['detail'] = $this->home_model->get_detail_isu_rilis_kode_kasus($this->uri->segment(3));
		$header = $this->header_model->get_data();
		
        $data1['active_menu'] = 1;
        $data3['active_tab'] = 3;
        $data['conversation'] = $this->home_model->get_conversation_by_id($this->uri->segment(3));
      
        $this->load->view('static/header',$header);
        $this->load->view('static/sub_nav/sub_nav_home',$data3);
		$this->load->view('respon_cepat/history_isu_rilis',$data);
        $this->load->view('static/footer');
    }
    
	public function history_isu_arsip($kode_kasus=0){
        $data1['active_menu'] = 1;
	    $data3['active_tab'] = 4;
     
        $data['detail_kasus'] = $this->home_model->get_detail_isu_arsip_kode_kasus($kode_kasus);
		$header = $this->header_model->get_data();
        $this->load->view('static/header', $header);
   
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('respon_cepat/history_isu_arsip',$data);
        $this->load->view('static/footer'); 
    }
	
    public function laporan_history_kasus_respon_cepat(){
        $detail_kasus = $this->home_model->get_detail_kasus_respon_cepat_by_kode_kasus($this->uri->segment(3));
        $data['detail_kasus'] = $detail_kasus;
        $data['detail_pelapor'] = $this->home_model->get_detail_pelapor_by_number($detail_kasus->no_pelapor);
        $data['conversation'] = $this->home_model->get_conversation_by_kode_kasus($this->uri->segment(3));
        $this->load->view('respon_cepat/cetak_history_kasus_respon_cepat',$data);
    }
    
    public function edit_proses($id_sms=''){
	    $data['detail'] = $this->home_model->get_detail_kategori_respon_cepat($id_sms);
        $header = $this->header_model->get_data();
		
        $data['list_kabupaten'] = $this->pelapor_model->get_kabupaten();
        $data['list_isu'] = $this->pengaturan_model->get_all_topik();
		$data['list_desa'] = $this->pelapor_model->get_desa_by_kecamatan();
        $data1['active_menu'] = 1;
        $data3['active_tab'] = 2;
        $data['conversation'] = $this->home_model->get_conversation_by_id($this->uri->segment(3));
      
        $this->load->view('static/header', $header);
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('edit_form',$data);
        $this->load->view('static/footer');
	}
		
    public function reply(){
        $data1['active_menu'] = 1;
        $data3['active_tab'] = 1;
		$header = $this->header_model->get_data();
		
        $data['conversation'] = $this->home_model->get_conversation_by_id($this->uri->segment(3));
        $data['reply_number'] = $this->home_model->get_number_by_id($this->uri->segment(3));
		
        $this->load->view('static/header', $header);
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('reply_form',$data);
        $this->load->view('static/footer');        
    }
	
    public function approve($id=0){     
		$this->home_model->approve($id);
        redirect('home'); 
    }
    
    public function submit_reply(){
        if ($this->input->post('no_hp') != "" && $this->input->post('isi_sms') != "") {
            if ($this->sms_model->process_kirim_sms()) {
                $_SESSION['status'] = 1;
            } else {
                $_SESSION['status'] = -1;
            }
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home');    
    }

    public function submit_forward(){
        if ($this->input->post('isi_sms') != "") {
            if ($this->sms_model->process_kirim_forward()) {
                $_SESSION['status'] = 1;
            } else {
                $_SESSION['status'] = -1;
            }
        } else {
            $_SESSION['status'] = -1;
        }
        redirect('home/dalam_proses');    
    }
	
	public function cari_pesan() {
        $cari = $this->input->post('cari');
		if($cari)
			$_SESSION['cari']=$cari;
		else $_SESSION['cari']="";
        redirect('home/index');        
    }
	
    public function clear() {
        unset($_SESSION['cari']);
		unset($_SESSION['filter_kategori']);
        redirect('home/index');        
    }
	
    public function clearrilis() {
        unset($_SESSION['cari']);
		unset($_SESSION['filter_kategori']);
		unset($_SESSION['filter_arsip']);
        redirect('home/isu_rilis');        
    }
	
	public function cleararsip() {
        unset($_SESSION['cari']);
		unset($_SESSION['filter_kategori']);
		unset($_SESSION['filter_arsip']);
        redirect('home/isu_arsip');        
    }
	
	public function isu_rilis($p=1,$o=0) {

		if(isset($_SESSION['filter_kategori']))
			$data['filter_kategori'] = $_SESSION['filter_kategori'];
		else $data['filter_kategori'] = '';
	
		if(isset($_SESSION['bulan'])){
			$data['bulan'] = $_SESSION['bulan'];}
		else {$data['bulan'] = date("m");
		$_SESSION['bulan'] = date("m");}
		
		if(isset($_SESSION['tahun'])){
		$data['tahun'] = $_SESSION['tahun'];}
		else {$data['tahun'] = date("Y");
		$_SESSION['tahun'] = date("Y");}
		
		$data['p']        = $p;
		$data['o']        = $o;
		
		if(isset($_POST['per_page'])) 
			$_SESSION['per_page']=$_POST['per_page'];
			$data['per_page'] = $_SESSION['per_page'];
	
		$header = $this->header_model->get_data();	
        $data1['active_menu'] = 1;
        $data3['active_tab'] = 3;
		$data['list_isu'] = $this->pengaturan_model->get_all_topik();
		$data['paging']  = $this->home_model->paging_isu_rilis($p,$o);
        $data['list_kasus'] = $this->home_model->get_isu_rilis($data['paging']->offset, $data['paging']->per_page);
		$data['list_desa'] = $this->pelapor_model->get_kabupaten();
        $this->load->view('static/header', $header);
 
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('respon_cepat/isu_rilis',$data);
        $this->load->view('static/footer');  
    }
	
	function filter_kategori(){
		
		$filter_kategori = $this->input->post('filter_kategori');
		if($filter_kategori!=0)
			$_SESSION['filter_kategori']=$filter_kategori;
		else unset($_SESSION['filter_kategori']);

		redirect("home/isu_rilis");
	}
	
	function filter_arsip(){
		
		$filter_arsip = $this->input->post('filter_arsip');
		if($filter_arsip!=0)
			$_SESSION['filter_arsip']=$filter_arsip;
		else unset($_SESSION['filter_arsip']);

		redirect("home/isu_arsip");
	}
	
	public function isu_arsip($p=1,$o=0) {
		
		if(isset($_SESSION['filter_arsip']))
			$data['filter_arsip'] = $_SESSION['filter_arsip'];
		else $data['filter_arsip'] = '';
		
		if(isset($_SESSION['bulan'])){
			$data['bulan'] = $_SESSION['bulan'];}
		else {$data['bulan'] = date("m");
		$_SESSION['bulan'] = date("m");}
		
		if(isset($_SESSION['tahun'])){
			$data['tahun'] = $_SESSION['tahun'];}
		else {$data['tahun'] = date("Y");
		$_SESSION['tahun'] = date("Y");}
		
		$data['p']        = $p;
		$data['o']        = $o;
		
		if(isset($_POST['per_page'])) 
			$_SESSION['per_page']=$_POST['per_page'];
		$data['per_page'] = $_SESSION['per_page'];
		
        $data1['active_menu'] = 1;
        $data3['active_tab'] = 4;
		$header = $this->header_model->get_data();
		$data['list_isu'] = $this->pengaturan_model->get_all_topik();
		$data['paging']  = $this->home_model->paging_isu_arsip($p,$o);
        $data['list_kasus'] = $this->home_model->get_isu_arsip($data['paging']->offset, $data['paging']->per_page);
		$data['list_desa'] = $this->pelapor_model->get_kabupaten();
        $this->load->view('static/header', $header);
 
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('respon_cepat/isu_arsip',$data);
        $this->load->view('static/footer');  
    }
	
	 public function isu_report($p=1,$o=0) {
				
		if(isset($_SESSION['bulan'])){
			$data['bulan'] = $_SESSION['bulan'];}
		else {$data['bulan'] = date("m");
		$_SESSION['bulan'] = date("m");}
		
		if(isset($_SESSION['tahun'])){
			$data['tahun'] = $_SESSION['tahun'];}
		else {$data['tahun'] = date("Y");
		$_SESSION['tahun'] = date("Y");}
		
		$data['p']        = $p;
		$data['o']        = $o;
		
		if(isset($_POST['per_page'])) 
			$_SESSION['per_page']=$_POST['per_page'];
		$data['per_page'] = $_SESSION['per_page'];
		
        $data1['active_menu'] = 1;
        $data3['active_tab'] = 5;
		$header = $this->header_model->get_data();
		
	$data['paging']  = $this->home_model->paging_isu_report($p,$o);
	$data['topik'] = $this->pengaturan_model->get_all_topik();
	$data['pesan_masuk'] = $this->pengaturan_model->get_all_pesan_masuk();
	$data['pesan_keluar'] = $this->pengaturan_model->get_all_pesan_keluar();
	$data['pesan_proses'] = $this->pengaturan_model->get_all_pesan_proses();
	$data['pesan_rilis'] = $this->pengaturan_model->get_all_pesan_rilis();
	$data['pesan_arsip'] = $this->pengaturan_model->get_all_pesan_arsip();
        $data['list_kasus'] = $this->home_model->get_kasus_respon_cepat($data['paging']->offset, $data['paging']->per_page);
        $this->load->view('static/header', $header);
   
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
     
		$this->load->view('respon_cepat/isu_report',$data);
		 
        $this->load->view('static/footer');  
    }
	
	 public function teruskan($id_sms=0){
        $data1['active_menu'] = 1;
   
        $data3['active_tab'] = 2;
        $data['conversation'] = $this->home_model->get_conversation_by_id($this->uri->segment(3));

		$data['detail'] = $this->home_model->get_detail_kategori_respon_cepat_by_id($id_sms);
        $data['list_pemberi_layanan'] = $this->pelapor_model->get_pemberi_layanan();
        $data['list_pihak_terkait'] = $this->pelapor_model->get_pihak_terkait();
        $this->load->view('static/header', $data1);
        
        $this->load->view('static/sub_nav/sub_nav_home', $data3);
        $this->load->view('teruskan_form',$data);
        $this->load->view('static/footer');
    }
	
	function tahun(){
		$tahun = $this->input->post('tahun');
		if($tahun!=0)
			$_SESSION['tahun']=$tahun;
		else $_SESSION['tahun']="";
		redirect('home/isu_rilis');
	}
	
	function bulan(){
		$bulan = $this->input->post('bulan');
		if($bulan!=0)
			$_SESSION['bulan']=$bulan;
		else $_SESSION['bulan']="";
		redirect('home/isu_rilis');	
	}
	
	
	function tahun_arsip(){
		$tahun = $this->input->post('tahun');
		if($tahun!=0)
			$_SESSION['tahun']=$tahun;
		else $_SESSION['tahun']="";
		redirect('home/isu_arsip');
	}
	
	function bulan_arsip(){
		$bulan = $this->input->post('bulan');
		if($bulan!=0)
			$_SESSION['bulan']=$bulan;
		else $_SESSION['bulan']="";
		redirect('home/isu_arsip');	
	}
	
	function tahun_report(){
		$tahun = $this->input->post('tahun');
		if($tahun!=0)
			$_SESSION['tahun']=$tahun;
		else $_SESSION['tahun']="";
		redirect('home/isu_report');
	}
	
	function bulan_report(){
		$bulan = $this->input->post('bulan');
		if($bulan!=0)
			$_SESSION['bulan']=$bulan;
		else $_SESSION['bulan']="";
		redirect('home/isu_report');	
	}    
}?>
